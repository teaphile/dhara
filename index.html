<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dhara-Rakshak | Landslide Risk Assessment Tool</title>

    <!-- SEO & Meta -->
    <meta name="description" content="Dhara-Rakshak: Scientific landslide risk assessment tool for Indian terrain. Geotechnical slope stability analysis using IS codes, interactive maps, multilingual voice alerts, and mitigation recommendations.">
    <meta name="keywords" content="landslide, risk assessment, slope stability, geotechnical, factor of safety, India, NIDM, IS 14496, mitigation, heatmap, Monte Carlo">
    <meta name="author" content="Dhara-Rakshak Team">
    <meta name="theme-color" content="#0D47A1">

    <!-- Open Graph (Social Media Sharing) -->
    <meta property="og:title" content="Dhara-Rakshak | Landslide Risk Assessment Tool">
    <meta property="og:description" content="Scientific landslide risk assessment for Indian hill terrain. Interactive maps, geotechnical analysis, multilingual voice alerts, and mitigation recommendations aligned with Indian standards.">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="en_IN">

    <!-- Favicon (inline SVG ‚Äî no external file needed) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèîÔ∏è</text></svg>">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <!-- Preconnect for faster CDN loading -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://api.open-meteo.com" crossorigin>
    <link rel="preconnect" href="https://earthquake.usgs.gov" crossorigin>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- App CSS -->
    <link rel="stylesheet" href="css/style.css" />
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- Chart.js Annotation Plugin (for FoS reference lines) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Leaflet Heat Plugin -->
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
</head>
<body>
    <!-- Accessibility Skip Link -->
    <a href="#page-input" class="skip-link">Skip to main content</a>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- No JavaScript Fallback -->
    <noscript>
        <div style="padding:40px;text-align:center;font-family:sans-serif;background:#FFCDD2;color:#B71C1C;">
            <h2>JavaScript Required</h2>
            <p>Dhara-Rakshak requires JavaScript to perform geotechnical analysis. Please enable JavaScript in your browser settings.</p>
        </div>
    </noscript>
    <!-- LOADING OVERLAY -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- MOBILE HAMBURGER -->
    <button id="hamburger-btn" class="hamburger-btn" aria-label="Toggle navigation menu">
        <span></span><span></span><span></span>
    </button>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
            <div class="brand-icon">D-R</div>
            <div>
                <div class="brand-title">Dhara-Rakshak</div>
                <div class="brand-subtitle">Landslide Risk Assessment</div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <div class="sidebar-nav-item active" data-page="page-input">
                <span class="nav-icon">1</span>
                <span class="nav-label">Site Input &amp; Map</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-results">
                <span class="nav-icon">2</span>
                <span class="nav-label">Analysis Results</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-risk-map">
                <span class="nav-icon">3</span>
                <span class="nav-label">Risk Map (1 km)</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-visualizer">
                <span class="nav-icon">4</span>
                <span class="nav-label">Data Visualizer</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-mitigation">
                <span class="nav-icon">5</span>
                <span class="nav-label">Mitigation</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-voice">
                <span class="nav-icon">6</span>
                <span class="nav-label">Voice Alerts</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-report">
                <span class="nav-icon">7</span>
                <span class="nav-label">Report</span>
            </div>
            <div class="sidebar-nav-item" data-page="page-dashboard">
                <span class="nav-icon">8</span>
                <span class="nav-label">Dashboard</span>
            </div>
        </nav>

        <!-- Dark Mode & Connectivity -->
        <div class="sidebar-controls">
            <button id="dark-mode-toggle" class="sidebar-toggle-btn" aria-label="Toggle dark mode" title="Toggle Dark Mode">
                <span id="dark-mode-icon">‚òÄ</span> <span class="nav-label">Dark Mode</span>
            </button>
            <div id="connectivity-status" class="connectivity-badge online">
                <span class="conn-dot"></span>
                <span class="nav-label" id="conn-label">Online</span>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="sf-line">Dhara-Rakshak v3.0</div>
            <div class="sf-line">Advanced Decision Support</div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <!-- ============================================================ -->
        <!-- PAGE 1 : SITE INPUT & MAP                                    -->
        <!-- ============================================================ -->
        <section id="page-input" class="module-page active">
            <div class="page-header">
                <h1>Site Assessment Input</h1>
                <p>Set location on map (click or drag marker), then enter geotechnical parameters.</p>
            </div>

            <!-- LIVE DATA STATUS BAR -->
            <div id="api-status-bar" class="api-status-bar">
                <span class="api-status-label">Live Data:</span>
                <span class="api-dot" id="dot-weather" title="Weather">Weather</span>
                <span class="api-dot" id="dot-elevation" title="Elevation">Elevation</span>
                <span class="api-dot" id="dot-earthquake" title="Earthquakes">Seismic</span>
                <span class="api-dot" id="dot-soilgrids" title="Soil Data">Soil</span>
                <span class="api-dot" id="dot-geocode" title="Location">Geocode</span>
                <span class="api-dot" id="dot-historical" title="Historical">Rainfall</span>
                <span id="api-fetch-time" class="api-fetch-time"></span>
            </div>

            <!-- LIVE LOCATION & WEATHER BANNER -->
            <div id="live-location-banner" class="live-banner" style="display:none">
                <div class="live-badge">LIVE</div>
                <div id="live-location-name" class="live-location"></div>
                <div id="live-weather-summary" class="live-weather"></div>
                <div id="live-elevation" class="live-elev"></div>
            </div>

            <div class="grid-2">
                <!-- LEFT: MAP -->
                <div class="card" style="min-height:420px">
                    <div class="card-header"><h3>Location Map</h3></div>
                    <div id="mapContainer" style="height:380px;border-radius:6px;overflow:hidden"></div>
                    <div class="map-coords" style="margin-top:8px;display:flex;gap:12px;align-items:center">
                        <label style="font-size:0.82rem;font-weight:600">Latitude</label>
                        <input type="number" id="inp-lat" step="0.00001" value="30.45000" class="form-control" style="width:140px" />
                        <label style="font-size:0.82rem;font-weight:600">Longitude</label>
                        <input type="number" id="inp-lon" step="0.00001" value="78.07000" class="form-control" style="width:140px" />
                        <button class="btn btn-secondary" onclick="DharaApp.goToCoords()" style="font-size:0.78rem">Go</button>
                    </div>
                </div>

                <!-- RIGHT: PARAMETERS -->
                <div class="card">
                    <div class="card-header"><h3>Geotechnical Parameters</h3></div>
                    <div class="form-grid">
                        <!-- Slope Angle -->
                        <div class="form-group">
                            <label>Slope Angle</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-slope" min="5" max="80" value="35" data-suffix=" deg" />
                                <span id="inp-slope-val" class="range-val">35 deg</span>
                            </div>
                        </div>
                        <!-- Soil Type -->
                        <div class="form-group">
                            <label>Soil Type (IS 1498)</label>
                            <select id="inp-soil" class="form-control">
                                <option value="clayey_sand">Clayey Sand (SC)</option>
                                <option value="silty_clay">Silty Clay (CL)</option>
                                <option value="sandy_gravel">Sandy Gravel (GW/GP)</option>
                                <option value="residual_soil">Residual Soil (Himalayan)</option>
                                <option value="weathered_rock">Weathered Rock</option>
                                <option value="colluvial_deposit">Colluvial Deposit</option>
                                <option value="black_cotton">Black Cotton Soil (CH)</option>
                                <option value="laterite">Laterite</option>
                            </select>
                        </div>
                        <!-- Vegetation % via Satellite (auto or manual) -->
                        <div class="form-group">
                            <label>Vegetation Cover (%)</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-veg" min="0" max="100" value="40" data-suffix="%" />
                                <span id="inp-veg-val" class="range-val">40%</span>
                            </div>
                            <button class="btn btn-sm btn-accent" onclick="DharaApp.fetchSatelliteGreen()" style="margin-top:4px;font-size:0.72rem">Estimate from Terrain Model</button>
                        </div>
                        <!-- Live Soil Data Indicator -->
                        <div class="form-group">
                            <label>Live Soil Data <span id="soil-live-badge" class="live-micro-badge" style="display:none">LIVE</span></label>
                            <div id="live-soil-info" class="live-soil-box">Click map to fetch real soil data from ISRIC SoilGrids...</div>
                        </div>
                        <!-- Rainfall -->
                        <div class="form-group">
                            <label>Rainfall Intensity (mm/hr)</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-rain-intensity" min="0" max="50" value="5" step="0.5" data-suffix=" mm/hr" />
                                <span id="inp-rain-intensity-val" class="range-val">5 mm/hr</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Rainfall Duration (hrs)</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-rain-duration" min="1" max="120" value="24" data-suffix=" hrs" />
                                <span id="inp-rain-duration-val" class="range-val">24 hrs</span>
                            </div>
                        </div>
                        <!-- Saturation -->
                        <div class="form-group">
                            <label>Soil Saturation (%)</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-saturation" min="0" max="100" value="50" data-suffix="%" />
                                <span id="inp-saturation-val" class="range-val">50%</span>
                            </div>
                        </div>
                        <!-- House Distance -->
                        <div class="form-group">
                            <label>Structure Distance from Slope (m)</label>
                            <div class="range-wrap">
                                <input type="range" id="inp-distance" min="0" max="50" value="6" data-suffix=" m" />
                                <span id="inp-distance-val" class="range-val">6 m</span>
                            </div>
                        </div>
                        <!-- Drainage -->
                        <div class="form-group">
                            <label>Drainage Condition</label>
                            <select id="inp-drainage" class="form-control">
                                <option value="poor">Poor</option>
                                <option value="moderate">Moderate</option>
                                <option value="good">Good</option>
                            </select>
                        </div>
                        <!-- Field Observations -->
                        <div class="form-group full-width">
                            <label>Field Observations</label>
                            <div class="checkbox-row">
                                <label class="cb-label"><input type="checkbox" id="inp-cracks" /> Visible Cracks</label>
                                <label class="cb-label"><input type="checkbox" id="inp-seepage" /> Water Seepage</label>
                                <label class="cb-label"><input type="checkbox" id="inp-past" /> Past Landslides</label>
                                <label class="cb-label"><input type="checkbox" id="inp-construction" /> Nearby Construction</label>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top:18px;display:flex;gap:12px;justify-content:flex-end;align-items:center">
                        <button class="btn btn-secondary" id="btn-fetch-live">Fetch Live Data</button>
                        <button class="btn btn-primary btn-lg" onclick="DharaApp.runAnalysis()">Run Full Analysis</button>
                    </div>
                </div>
            </div>

            <!-- SATELLITE VIEW PANEL -->
            <div class="card" id="satellite-panel" style="display:none;margin-top:16px">
                <div class="card-header"><h3>Terrain Model -- Green Cover Estimation</h3></div>
                <div class="grid-2">
                    <div id="satellite-map-container" style="height:350px;border-radius:6px;overflow:hidden"></div>
                    <div id="satellite-info" style="padding:12px">
                        <p style="font-size:0.85rem;color:#666">This view uses Esri World Imagery to estimate vegetation (green) percentage in a 500m radius around the selected location.</p>
                        <div id="green-pct-display" style="font-size:2rem;font-weight:700;color:#2E7D32;margin:16px 0">--</div>
                        <p id="green-pct-note" style="font-size:0.78rem;color:#888">Estimated from terrain model (latitude, slope, rainfall zone). Not satellite pixel analysis. Used for root cohesion calculation.</p>
                        <button class="btn btn-secondary" onclick="DharaApp.applySatelliteGreen()">Apply to Vegetation %</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 2 : ANALYSIS RESULTS                                    -->
        <!-- ============================================================ -->
        <section id="page-results" class="module-page">
            <div class="page-header">
                <h1>Analysis Results</h1>
                <p>Comprehensive geotechnical slope stability assessment</p>
            </div>

            <!-- Risk Banner -->
            <div id="risk-banner" class="risk-banner"></div>

            <!-- Summary Metrics -->
            <div class="grid-4">
                <div class="metric-card" id="res-fos">
                    <div class="metric-label">Factor of Safety</div>
                    <div class="metric-value">--</div>
                </div>
                <div class="metric-card" id="res-risk-score">
                    <div class="metric-label">Risk Score</div>
                    <div class="metric-value">--</div>
                </div>
                <div class="metric-card" id="res-pf">
                    <div class="metric-label">Failure Probability</div>
                    <div class="metric-value">--</div>
                </div>
                <div class="metric-card" id="res-confidence">
                    <div class="metric-label">Confidence</div>
                    <div class="metric-value">--</div>
                </div>
            </div>

            <!-- Charts Row 1 -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>Risk Gauge</h3></div>
                    <div class="chart-container"><canvas id="chart-risk-gauge"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Factor of Safety Comparison</h3></div>
                    <div class="chart-container"><canvas id="chart-fos"></canvas></div>
                </div>
            </div>

            <!-- Charts Row 2 -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>Monte Carlo Simulation</h3></div>
                    <div class="chart-container"><canvas id="chart-mc"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Sensitivity Analysis</h3></div>
                    <div class="chart-container"><canvas id="chart-sensitivity"></canvas></div>
                </div>
            </div>

            <!-- Charts Row 3 -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>Risk Component Radar</h3></div>
                    <div class="chart-container"><canvas id="chart-radar"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>I-D Threshold (Rainfall)</h3></div>
                    <div class="chart-container"><canvas id="chart-id"></canvas></div>
                </div>
            </div>

            <!-- Infiltration -->
            <div class="card">
                <div class="card-header"><h3>Infiltration Timeline</h3></div>
                <div class="chart-container"><canvas id="chart-infiltration"></canvas></div>
            </div>

            <!-- LIVE DATA PANELS (filled dynamically) -->
            <div id="live-data-panels" style="display:none">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header"><h3>Live Weather <span class="live-micro-badge">LIVE</span></h3></div>
                        <div id="live-weather-detail"></div>
                        <div class="chart-container" style="height:250px"><canvas id="chart-weather-timeline"></canvas></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Seismic Activity <span class="live-micro-badge">LIVE</span></h3></div>
                        <div id="live-earthquake-detail"></div>
                        <div class="chart-container" style="height:250px"><canvas id="chart-seismic"></canvas></div>
                    </div>
                </div>
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header"><h3>Historical Rainfall (30 Days) <span class="live-micro-badge">LIVE</span></h3></div>
                        <div class="chart-container" style="height:250px"><canvas id="chart-historical-rain"></canvas></div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h3>Soil Composition (SoilGrids) <span class="live-micro-badge">LIVE</span></h3></div>
                        <div id="live-soil-detail"></div>
                        <div class="chart-container" style="height:250px"><canvas id="chart-soil-composition"></canvas></div>
                    </div>
                </div>
            </div>

            <!-- Detail Tables -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>FoS Detail</h3></div>
                    <table class="data-table">
                        <thead><tr><th>Method</th><th>FoS</th><th>Standard</th></tr></thead>
                        <tbody id="fos-detail-table"></tbody>
                    </table>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Foundation Safety</h3></div>
                    <table class="data-table">
                        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
                        <tbody id="foundation-detail"></tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <div class="card-header"><h3>Risk Component Breakdown</h3></div>
                <table class="data-table">
                    <thead><tr><th>Component</th><th>Score</th><th>Weight</th><th>Weighted</th><th>Input</th></tr></thead>
                    <tbody id="component-breakdown"></tbody>
                </table>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 2B: LIVE WEATHER & SEISMIC PANELS (injected into results) -->
        <!-- ============================================================ -->

        <!-- ============================================================ -->
        <!-- PAGE 3 : RISK MAP (1 km Radius)                             -->
        <!-- ============================================================ -->
        <section id="page-risk-map" class="module-page">
            <div class="page-header">
                <h1>Risk Heatmap -- 1 km Radius</h1>
                <p>Simulated landslide susceptibility map. Red = high risk, Yellow = low risk.</p>
            </div>
            <div class="card" style="min-height:500px">
                <div id="riskMapContainer" style="height:520px;border-radius:6px;overflow:hidden"></div>
            </div>
            <div class="card" style="margin-top:12px">
                <div class="card-header"><h3>Legend</h3></div>
                <div style="display:flex;gap:20px;align-items:center;padding:8px 0">
                    <span style="display:inline-block;width:20px;height:20px;background:#d73027;border-radius:3px"></span> High Risk
                    <span style="display:inline-block;width:20px;height:20px;background:#fc8d59;border-radius:3px"></span> Moderate-High
                    <span style="display:inline-block;width:20px;height:20px;background:#fee08b;border-radius:3px"></span> Moderate
                    <span style="display:inline-block;width:20px;height:20px;background:#d9ef8b;border-radius:3px"></span> Low-Moderate
                    <span style="display:inline-block;width:20px;height:20px;background:#1a9850;border-radius:3px"></span> Low Risk
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 4 : DATA VISUALIZER                                     -->
        <!-- ============================================================ -->
        <section id="page-visualizer" class="module-page">
            <div class="page-header">
                <h1>Data Visualizer</h1>
                <p>Visualize the parameters you entered and analysis outputs interactively.</p>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>Input Parameters Summary</h3></div>
                    <div class="chart-container"><canvas id="viz-input-radar"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>Soil Properties</h3></div>
                    <div class="chart-container"><canvas id="viz-soil-bar"></canvas></div>
                </div>
            </div>
            <div class="grid-2">
                <div class="card">
                    <div class="card-header"><h3>Risk Component Weights</h3></div>
                    <div class="chart-container"><canvas id="viz-weight-pie"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3>FoS vs Slope Angle Curve</h3></div>
                    <div class="chart-container"><canvas id="viz-fos-slope"></canvas></div>
                </div>
            </div>
            <div class="card">
                <div class="card-header"><h3>Custom Data Table</h3></div>
                <div id="viz-data-table-container">
                    <table class="data-table" id="viz-data-table">
                        <thead><tr><th>Parameter</th><th>Value</th><th>Unit</th><th>Category</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 5 : MITIGATION                                          -->
        <!-- ============================================================ -->
        <section id="page-mitigation" class="module-page">
            <div class="page-header">
                <h1>Mitigation Recommendations</h1>
                <p>Engineering measures based on IS 14458 and NDMA guidelines</p>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="DharaApp.switchMitTab(this,'mit-tab-immediate')">Immediate</button>
                <button class="tab-btn" onclick="DharaApp.switchMitTab(this,'mit-tab-short')">Short-Term</button>
                <button class="tab-btn" onclick="DharaApp.switchMitTab(this,'mit-tab-long')">Long-Term</button>
                <button class="tab-btn" onclick="DharaApp.switchMitTab(this,'mit-tab-monitoring')">Monitoring</button>
            </div>

            <div id="mit-tab-immediate" class="tab-content active"><div id="mit-immediate"></div></div>
            <div id="mit-tab-short" class="tab-content"><div id="mit-shortterm"></div></div>
            <div id="mit-tab-long" class="tab-content"><div id="mit-longterm"></div></div>
            <div id="mit-tab-monitoring" class="tab-content">
                <div class="card">
                    <div class="card-header"><h3>Monitoring Plan</h3></div>
                    <table class="data-table">
                        <thead><tr><th>Instrument</th><th>Frequency</th><th>Purpose</th><th>Cost</th></tr></thead>
                        <tbody id="mit-monitoring"></tbody>
                    </table>
                </div>
            </div>

            <!-- Outcome -->
            <div class="card" style="margin-top:16px">
                <div class="card-header"><h3>Before vs After Mitigation</h3></div>
                <div id="outcome-summary"></div>
                <div class="chart-container"><canvas id="chart-outcome"></canvas></div>
            </div>
            <div class="card">
                <div class="card-header"><h3>Cost Breakdown</h3></div>
                <div class="chart-container"><canvas id="chart-cost-pie"></canvas></div>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 6 : VOICE ALERTS                                        -->
        <!-- ============================================================ -->
        <section id="page-voice" class="module-page">
            <div class="page-header">
                <h1>Multilingual Voice Alerts</h1>
                <p>Community alert system in 5 languages</p>
            </div>
            <div id="voice-container" class="card"></div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 7 : REPORT                                              -->
        <!-- ============================================================ -->
        <section id="page-report" class="module-page">
            <div class="page-header">
                <h1>Engineering Report</h1>
                <p>Auto-generated geotechnical assessment report</p>
            </div>
            <div style="margin-bottom:12px;display:flex;gap:10px;flex-wrap:wrap">
                <button class="btn btn-primary" onclick="DharaApp.downloadReport()">Download Report (HTML)</button>
                <button class="btn btn-secondary" onclick="DharaApp.exportJSON()">Export Data (JSON)</button>
                <button class="btn btn-secondary" onclick="DharaApp.exportCSV()">Export Data (CSV)</button>
            </div>
            <div class="card" style="padding:0">
                <iframe id="report-preview-frame" style="width:100%;height:700px;border:none;border-radius:6px"></iframe>
            </div>
        </section>

        <!-- ============================================================ -->
        <!-- PAGE 8 : DASHBOARD                                           -->
        <!-- ============================================================ -->
        <section id="page-dashboard" class="module-page">
            <div class="page-header">
                <h1>Dashboard</h1>
                <p>Overall assessment summary and analysis history</p>
            </div>
            <div id="dashboard-content">
                <div class="card"><p style="color:#888;padding:20px">Run analysis first to see dashboard summary.</p></div>
            </div>
            <!-- Analysis History -->
            <div class="card" style="margin-top:18px">
                <div class="card-header"><h3>Analysis History</h3></div>
                <div id="analysis-history">
                    <p style="color:#888;font-size:0.85rem">No previous analyses saved yet.</p>
                </div>
                <div style="margin-top:12px;display:flex;gap:10px">
                    <button class="btn btn-secondary btn-sm" onclick="DharaApp.clearHistory()">Clear History</button>
                </div>
            </div>
        </section>
    </main>

    <!-- JS Modules (order matters) -->
    <script src="js/api-service.js"></script>
    <script src="js/geotechnical-engine.js"></script>
    <script src="js/risk-classifier.js"></script>
    <script src="js/mitigation-engine.js"></script>
    <script src="js/charts.js"></script>
    <script src="js/map-module.js"></script>
    <script src="js/voice-system.js"></script>
    <script src="js/report-generator.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(function() {});
        }
        // Preload dark mode before paint to prevent flash
        (function() {
            if (localStorage.getItem('dhara-dark-mode') === '1') {
                document.body.classList.add('dark-mode');
            }
        })();
    </script>
</body>
</html>
